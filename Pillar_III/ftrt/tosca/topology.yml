tosca_definitions_version: alien_dsl_3_0_0

metadata:
  template_name: PTF_Workflow
  template_version: 0.1.0
  template_author: jorge

description: ""

imports:
  - eflows4hpc.env:1.1.0
  - yorc-types:1.1.0
  - tosca-normative-types:1.0.0-ALIEN20
  - alien-base-types:3.0.0
  - org.eflows4hpc.pycompss.plugin:1.1.0

topology_template:
  node_templates:
    AbstractEnvironment:
      metadata:
        a4c_edit_x: 229
        a4c_edit_y: "-1"
      type: eflows4hpc.env.nodes.AbstractEnvironment
    PyCOMPSJob:
      metadata:
        a4c_edit_x: "-9"
        a4c_edit_y: 0
      type: org.eflows4hpc.pycompss.plugin.nodes.PyCOMPSJob
      properties:
        submission_params: 
          qos: debug
          python_interpreter: python3
          num_nodes: 1
          extra_compss_opts: "--env_script=${app_path}/env.sh --exec_time=${exec_time}"
        application: 
          container_opts: 
            container_opts: "-e"
          arguments: 
            - "--seistype $seis_type"
            - "--parameters_file $parameters_file"
            - "--data_path ${data_path}"
            - "--run_path ${run_path}"
            - "--templates_path ${templates_path}"
            - "--kagan_weight ${kagan_weight}"
            - "--mare_weight ${mare_weight}"
            - "--hours ${hours}"
            - "--group_sims=${group_sims}"
            - "--cfg from_template"
            - "--event ${event}"
          command: "${app_path}/Code/launch_pycompss.py"
        keep_environment: true
      requirements:
        - dependsOnAbstractEnvironmentExec_env:
            type_requirement: environment
            node: AbstractEnvironment
            capability: eflows4hpc.env.capabilities.ExecutionEnvironment
            relationship: tosca.relationships.DependsOn
  workflows:
    PTFExecution:
      inputs:
        user_id:
          type: string
          required: true
        vault_id:
          type: string
          required: true
        app_path:
          type: string
          required: true
        run_path:
          type: string
          required: true
        data_path:
          type: string
          required: true
        templates_path:
          type: string
          required: true
        parameters_file:
          type: string
          required: true
        num_nodes:
          type: integer
          required: false
          default: 1
        exec_time:
          type: integer
          required: false
          default: 20
        event:
          type: string
          required: true
        seis_type:
          type: string
          required: false
          default: BS
        kagan_weight:
          type: integer
          required: false
          default: 0
        mare_weight:
          type: integer
          required: false
          default: 0
        hours:
          type: integer
          required: false
          default: 1
        group_sims:
          type: integer
          required: false
          default: 0
      steps:
        PyCOMPSJob_run:
          target: PyCOMPSJob
          activities:
            - call_operation: tosca.interfaces.node.lifecycle.Runnable.run
        PyCOMPSJob_submit:
          target: PyCOMPSJob
          activities:
            - call_operation: tosca.interfaces.node.lifecycle.Runnable.submit
          on_success:
            - PyCOMPSJob_run
